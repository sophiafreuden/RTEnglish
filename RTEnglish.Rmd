---
title: "RTEnglish"
author: "Sophia Freuden"
date: "1/7/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
library(tm)
library(SentimentAnalysis)
library(syuzhet)
library(SnowballC)
library(wordcloud)
library(RColorBrewer)
library(RCurl)
library(textclean)
library(lubridate)
library(gt)
library(webshot)
library(htmlwidgets)
library(tidyverse)
```

```{r}
col_types = cols(
  date = col_character(),
  title = col_character(),
  content = col_character(),
  URL = col_character()
)

data <- read_csv("soros-russia.csv", col_types = col_types)

data <- data %>%
  mutate(date = dmy(date))

# view(data)
```

```{r}
Encoding(data$content) <- "latin1"

data$content <- replace_non_ascii(data$content)
```

```{r}
corpus <- SimpleCorpus(VectorSource(data$content))
# view(corpus)
```

```{r}
corpus <- tm_map(corpus, stripWhitespace)

corpus <- tm_map(corpus, content_transformer(tolower))

corpus <- tm_map(corpus, removeNumbers)

corpus <- tm_map(corpus, removePunctuation)

corpus <- tm_map(corpus, removeWords, stopwords("english"))
```

```{r}
# test1 <- corpus[[189]]$content
```

```{r}
nonstem.corpus <- corpus
corpus <- tm_map(corpus, stemDocument)
```

```{r}
# test2 <- corpus[[189]]$content
# test3 <- nonstem.corpus[[189]]$content
```

```{r}
DTM <- DocumentTermMatrix(corpus)
# view(DTM)
# inspect(DTM)
```

```{r}
nDTM <- DocumentTermMatrix(nonstem.corpus)
# view(nDTM)
```

```{r}
sums <- as.data.frame(colSums(as.matrix(nDTM)))
sums <- rownames_to_column(sums) 
colnames(sums) <- c("term", "count")
sums <- arrange(sums, desc(count))
head <- sums[1:75,]

sums2 <- as.data.frame(as.matrix(nDTM))
```

```{r}
sums2$ArtDate <- data$date
```

```{r}
wc1 <- wordcloud(words = head$term, freq = head$count, min.freq = 1000,
  max.words=100, random.order=FALSE, rot.per=0.35, 
  colors=brewer.pal(8, "Dark2"))

# This must be saved manually (right click the image when it appears.)
```

```{r}
# The word cloud above uses the non-stemmed documents. The one below used the stemmed
# documents. For word clouds specifically, it may be better to use non-stemmed documents.
```

```{r}
sums2 <- as.data.frame(colSums(as.matrix(DTM)))
sums2 <- rownames_to_column(sums2) 
colnames(sums2) <- c("term", "count")
sums2 <- arrange(sums2, desc(count))
head2 <- sums2[1:75,]
```

```{r}
wordcloud(words = head2$term, freq = head2$count, min.freq = 1000,
  max.words=100, random.order=FALSE, rot.per=0.35, 
  colors=brewer.pal(8, "Dark2"))
```

```{r}
sent <- analyzeSentiment(DTM, language = "english")
# view(sent)

sent <- sent[,1:4]

sent <- as.data.frame(sent)

# view(sent)

sum1 <- tibble(summary(sent$SentimentGI))

final <- bind_cols(data, sent)

# head(final)
```

```{r}
sum2 <- as.data.frame(t(sum1))

table1 <- sum2 %>%
  gt() %>%
  tab_header(
    title = "Sentiment Polarization Summary",
    subtitle = "Search Term: 'soros russia'"
    )  %>% 
  cols_label(
    V1 = "Min.",
    V2 = "1st Qu.",
    V3 = "Median",
    V4 = "Mean",
    V5 = "3rd Qu.",
    V6 = "Max."
    ) %>% 
  gtsave("table1.png", zoom = 2.5, expand = 10)
```

```{r}
sent2 <- get_nrc_sentiment(data$content, language = "english")

sent3 <- as.data.frame(colSums(sent2))

sent3 <- rownames_to_column(sent3)

colnames(sent3) <- c("emotion", "count")
```

```{r}
emo1 <- ggplot(sent3, aes(x = emotion, y = count, fill = emotion)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  theme(legend.position="none", panel.grid.major = element_blank()) +
  labs( x = "Emotion", y = "Total Count") +
  ggtitle("Emotion Analysis of 'soros russia'") +
  theme(plot.title = element_text(hjust=0.5))
```

```{r}
pdf("emo1.pdf", width = 11)
emo1
dev.off()
```











